<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digital Gift Tic Tac Toe</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 { margin-top: 24px; }
    #game {
      display: grid;
      grid-template-columns: repeat(3, 80px);
      gap: 8px;
      justify-content: center;
      margin: 28px auto 10px auto;
      width: max-content;
    }
    .cell {
      width: 80px;
      height: 80px;
      font-size: 2.2em;
      font-weight: bold;
      background: #fff;
      border: 2px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .cell:disabled { background: #eee; cursor: default; }
    .winner { background: #fffb91 !important; color: #d19f00; }
    #status { font-size: 1.2em; margin: 12px 0 18px 0; }
    #reset {
      margin: 10px 0 30px 0;
      padding: 8px 24px;
      font-size: 1em;
      border-radius: 6px;
      border: none;
      background: #1976d2;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }
    #reset:hover { background: #135ba1; }
    #popup {
      position: fixed; left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.5);
      display: none; align-items: center; justify-content: center;
      z-index: 999;
    }
    #popup-content {
      background: #fff;
      padding: 32px 32px 24px 32px;
      border-radius: 12px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.15);
      max-width: 90vw;
      text-align: center;
      position: relative;
    }
    #close-popup {
      position: absolute; top: 10px; right: 16px;
      font-size: 1.2em; cursor: pointer; color: #888;
    }
    #close-popup:hover { color: #d32f2f; }
  </style>
</head>
<body>
  <h1>Digital Gift Tic Tac Toe</h1>
  <div id="status">Your turn!</div>
  <div id="game"></div>
  <button id="reset">Reset</button>

  <div id="popup">
    <div id="popup-content">
      <span id="close-popup" title="Close">&times;</span>
      <h2>Congratulations!</h2>
      <p>Thanks for playing! ðŸŽ‰<br>
      (You can personalize this message...)</p>
    </div>
  </div>

  <!-- Audio Elements: place your mp3 files in the same folder -->
  <audio id="move-sound" src="move.mp3" preload="auto"></audio>
  <audio id="win-sound" src="win.mp3" preload="auto"></audio>
  <audio id="bg-music" src="bgmusic.mp3" preload="auto" loop></audio>

  <script>
const moveSound = document.getElementById('move-sound');
const winSound = document.getElementById('win-sound');
const bgMusic = document.getElementById('bg-music');
bgMusic.volume = 0.2;

function playMoveSound() {
  try {
    moveSound.currentTime = 0;
    moveSound.play();
  } catch (e) {}
}

function playWinSound() {
  try {
    winSound.currentTime = 0;
    winSound.play();
  } catch (e) {}
}

const gameBoard = document.getElementById('game');
const statusText = document.getElementById('status');
const resetBtn = document.getElementById('reset');
const popup = document.getElementById('popup');
const closePopup = document.getElementById('close-popup');

let board = Array(9).fill('');
let gameActive = true;
let winLine = [];

function renderBoard() {
  gameBoard.innerHTML = '';
  board.forEach((cell, idx) => {
    const div = document.createElement('button');
    div.className = 'cell';
    div.innerText = cell;
    div.disabled = !gameActive || cell !== '' || currentPlayer() !== 'X';
    if (winLine.includes(idx)) div.classList.add('winner');
    div.addEventListener('click', () => handleMove(idx));
    gameBoard.appendChild(div);
  });
}

function currentPlayer() {
  const xCount = board.filter(v => v === 'X').length;
  const oCount = board.filter(v => v === 'O').length;
  return xCount === oCount ? 'X' : 'O';
}

function handleMove(idx) {
  if (!gameActive || board[idx] !== '' || currentPlayer() !== 'X') return;

  board[idx] = 'X';
  renderBoard();
  playMoveSound();
  const won = checkWin(board, 'X');
  if (won) {
    winLine = won;
    renderBoard();
    playWinSound();
    statusText.innerText = `You win!`;
    gameActive = false;

    // ðŸŽµ Start background music only if player wins
    bgMusic.play().catch(() => {});

    setTimeout(showProposal, 900);
  } else if (board.every(cell => cell !== '')) {
    statusText.innerText = "It's a draw!";
    gameActive = false;
    setTimeout(showProposal, 900);
  } else {
    statusText.innerText = `My turn...`;
    setTimeout(computerMove, 600);
  }
}

function computerMove() {
  if (!gameActive) return;
  const emptyCells = board
    .map((cell, idx) => cell === '' ? idx : null)
    .filter(idx => idx !== null);
  if (emptyCells.length === 0) return;
  const moveIdx = emptyCells[Math.floor(Math.random() * emptyCells.length)];
  board[moveIdx] = 'O';
  renderBoard();
  const won = checkWin(board, 'O');
  if (won) {
    winLine = won;
    renderBoard();
    statusText.innerText = `Computer wins!`;
    gameActive = false;
    setTimeout(showProposal, 900);
  } else if (board.every(cell => cell !== '')) {
    statusText.innerText = "It's a draw!";
    gameActive = false;
    setTimeout(showProposal, 900);
  } else {
    statusText.innerText = `Your turn!`;
  }
}

function checkWin(b, p) {
  const winPatterns = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  for (let pattern of winPatterns) {
    if (pattern.every(i => b[i] === p)) return pattern;
  }
  return false;
}

function showProposal() {
  popup.style.display = 'flex';
}
closePopup.onclick = function() {
  popup.style.display = 'none';
};
resetBtn.onclick = function() {
  board = Array(9).fill('');
  gameActive = true;
  winLine = [];
  statusText.innerText = `Your turn!`;
  renderBoard();
  popup.style.display = 'none';

  // Stop background music on reset
  bgMusic.pause();
  bgMusic.currentTime = 0;
};

// Initial render
renderBoard();
  </script>
</body>
</html>
